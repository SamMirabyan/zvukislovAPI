# zvukiStats - красивый вывод данных от zvukislov API

### Что это
_**zvukiStats**_ - небольшая cli-программа, которая позволяет вывести в терминал в красивом формате информацию об аудиокнигах и их авторах, размещенную в API zvukislov.ru/api.

### Зачем это
Ничего сверхъестественного - просто нашел интересный API и решил *"подергать ручку"*.

### Что может
zvukiStats поддерживает несколько опций:
- `--load (-l)`: получение данных от API и их заливка в БД (`mongodb`). Если в рабочей коллекции уже есть документы, залить данные не получится. В этом случае сначала очиститите коллекцию с помощью опции `--drop_collection (-D)`, затем попробуйте снова.
- `--author (-a) [запрос]`: вывод таблицы с наиболее популярными аудиокнигами автора. Для поиска необязательно вводить ФИО автора полностью, можно ввести только фамилию или фамилию и имя.
- `--book (-b) [запрос]`: вывод таблицы с наиболее популярными аудиокнигами, название которых подходит под запрос. Для получения более полного результата зачастую лучше выполнять поиск по ключевым словам, а не по точному названию, например: "каренина" (для произведения "Анна Каренина").
- `--stats (-s)`: вывод инфо панелей с интересной статистикой.
- `--drop_collection (-D)`: удалить все документы в текущей коллекции.
- `--test (-t)`: проверка тестовых функций. Техническая опция (в настоящий момент ничего не делает).

### Как работает
- получение данных от API и их загрузка в БД выполняются асинхронно с помощью `aiohttp` и `motor` соответственно. За счет этого достигается высокая скорость загрузки данных.
- построение таблиц и инфо панелей выполняется с помощью `rich` в более синхронном стиле с целью сохранить последовательность вывода данных.

### Технические требования
- для этого проекта на локальной машине исользовался `python 3.8.10`. Остальные пакеты были установлены с помощью `pip install` без каких либо указаний на версии. В процессе разработки коллизий не наблюдалось.
- mongodb работала в докер-контейнере, image: `mongodb:latest`.

### Обратите внимание
zvukiStats по умолчанию работает с `test_collection` из `test_database`. Перед загрузкой данных из API, убедитесь, что `test_collection` не содержит документов, чтобы избежать непредвиденного поведения.
В дальнейшем, при доработке программы, планируется добавить возможность выбора рабочей БД и коллекции.

### Как попробовать (инструкция для Linux)
#### Установка "вручную"
1. Клонируйте этот репозиторий на локальную машину и перейдите в рабочую директорию проекта.
```bash
git clone ...
cd ...
```
2. Установите и активируйте вирутальное окружение
```bash
python3 -m venv venv
source venv/bin/activate
```
3. Установите зависимости
```python
(venv) pip install -r requirements.txt
```
4. Убедитесь, что БД mongodb установлена. По умолчанию zvukiStats использует 'localhost' и порт 27888. Если вы хотите поменять эти настройки, то при создании `db_manager` в `__main__.py` передайте кортеж со своими настройками.
```python
# __main__.py
...
from .db_manager import DBManager
...
db_manager = DBManager(connection_args=("host", "port"))
...
```
4.1. Если у вас нет mongodb, но есть docker, то можно использовать следующую команду
```bash
sudo docker run -d --name mongo_test -p 27888:27017 -v mongo-data:/data/db mongo:latest
```
5. Проверьте, что программа работает
```bash
(venv) python -m zvukiStats -h
```
Выводит:
```
usage: zvukiStats [-h] [-l] [-D] [-a AUTHOR [AUTHOR ...]] [-b BOOK [BOOK ...]] [-s] [-t]

Программа для получения данных от API `zvukislov.ru/api/`, сохранения их в БД и последующей обработки.

optional arguments:
  -h, --help            show this help message and exit
  -l, --load            получить данные от API и загрузить в базу данных
  -D, --drop_collection
                        очистить текущую коллекцию
  -a AUTHOR [AUTHOR ...], --author AUTHOR [AUTHOR ...]
                        показать данные об авторе
  -b BOOK [BOOK ...], --book BOOK [BOOK ...]
                        показать данные о книге
  -s, --stats           показать интересную статистику
  -t, --test            проверить тестовые функции
```
6. Переходите к секции с примерами.

#### Установка с помощью docker-compose
1. Скачайте docker-compose.yml.
2. Создайте новы контейнер с помощью команды
```bash
sudo docker-compose up -d --build 
```
3. Начните работу с контейнером в интерактивном режиме
```bash
sudo docker exec -it ... bash
```
4. Проверьте, что программа работает
```bash
python3 -m zvukiStats -h
```
5. Переходите к секции с примерами.

### Примеры
```bash
(venv) python -m zvukiStats -a толстой => Таблица с наиболее популярными аудиокнигами, в имени автора которых есть слово "толстой";
# сюда может попадать как "Лев Толстой", так и "Алексей Толстой", в зависимости от популярности книг.
(venv) python -m zvukiStats -a NON_EXISTING_QUERY => сообщение о неудачном выполнении запроса (очевидно);
(venv) python -m zvukiStats -b солярис => Таблица с наиболее популярными аудиокнигами, в названии которых есть слово "солярис";
(venv) python -m zvukiStats -b друзей => Таблица с наиболее популярными аудиокнигами, в названии которых есть слово "друзей";
# например, "Как завоевывать друзей и оказывать влияние на людей" или "Приключения Незнайки и его друзей".
(venv) python -m zvukiStats -s => Набор инфо-панелей с интересной статистикой по БД.
```
### Над чем еще нужно поработать
- добавить тесты;
- добавить возможность выбора БД и коллекции

### Над проектом работают
[Sam Mirabyan](https://sammirabyan.github.io).